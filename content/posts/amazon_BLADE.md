---
title: '✏️ 아마존이 선택한 추천 알고리즘, BLADE'
date: '2023-10-06'
categories: ['GNN', 'Deep Learning', 'RecSys']
showToc: true
ShowBreadCrumbs: true
comments : true
draft : true
---

## 1. RecSys 2023

2023 The ACM Conference on Recommender Systems (RecSys)
추천 시스템 분야의 새로운 연구 결과와 기술을 발표하는 국제 포럼
올해는 싱가포르에서 개최되었음

기조연설은 Amazon International Emerging Stores 부의 응용과학담당 부사장 Rajeev Rastogi가
그는 추천 알고리즘 작업에서 아마존이 직면한 세가지 문제에 대해 이야기하였음

세가지 문제는 다음과 같음
1. 방향성 그래프에서의 추천
2. 시간이 지남에 따라 대상 레이블이 변경될 경우 머신러닝 모델 훈련을 어떻게 할 것인지
3. 예측 불확실성 추정치를 활용해 모델의 정확도를 개선하는 문제

오늘 집중해볼 것은 방향성 그래프에 대한 것


## 2. Directed Graphs

첫 번째 문제는 엣지가 한 방향으로 이어지는 방향성 그래프와 관련되어 있음
왜냐하면 연관 제품 관계는 비대칭적이거든
가령 휴대폰 노드와 휴대폰 케이스 노드가 있다고 가정해보겠음
휴대폰 노드가 주어지면 휴대폰 케이스 노드를 추천하고 싶은 게 인지상정 / 이건 합리적임

하지만 그 반대라면? 
고객이 휴대폰 케이스를 구매한 적이 있다면 이미 그 고객은 휴대폰을 가지고 있을 것
이 경우엔 휴대폰 추천이 필요하지 않을 수 있다
이런게 바로 asymmetric relationship
그리고 이걸 그래프로 표시하면 방향성 그래프가 될 것

단일 임베딩 공간은 방향성 그래프에서 노드 간 비대칭 관계를 모델링 하기에 표현력이 부족하다는 한계가 있음
그래서 아마존에서는 전체 그래프 구조를 활용해 이중 임베딩을 학습
아마존이 자체 개발한 BLADE 알고리즘을 적용해 해결

또한 바닐라 GNN에선 모든 노드에 대해 고정된 이웃 크기를 샘플링함
아마존에서는 최적화를 위해 adaptive sampling 기술을 추가로 적용하였다고


## 3. BLADE

Biased Locally Adaptive Direction AwarE
이 알고리즘은 WSDM 2023에서 아마존이 발표한 것
논문의 목표는 다음과 같다
방향성 그래프와 쿼리 노드가 입력값일 때 쿼리 노드와 연결될 가능성이 높은 상위 노드를 추천하는 것이 목표

해결 방법
엣지의 존재 유무와 엣지의 방향을 동시에 포착하기 위해 비대칭 손실함수를 사용
각 노드에 대해 인접 노드의 feature를 적절히 집계하여 개별 임베딩 수행
노드의 연결 구조에 따라 국지적으로 서로 다른 다양한 이웃을 생성하는 이웃-기반 샘플링 


 
### 그래프 문제로 관련 상품 추천하기
쿼리 상품 Q가 주어졌을 때, Q와 함께 구매될 가능성이 높은 상위 K개의 상품을 추천이 목표
고객-제품 간 상호작용을 바탕으로 제품 그래프 G를 자연스럽게 구성할 수 있음
문제는 방향성 그래프의 노드 추천임

### 하지만 그래프로 바라볼 때의 문제점
1. 본질적으로 제품-제품 관계는 비대칭적이다
즉 그래프로 표현하면 방향이 존재하는 그래프(directed graph)라고 할 수 있다.
그런데 방향성 그래프를 처리하는 랜덤워크 기반 모델은 GNN에 비해 성능이 떨어진다.

2. 노드와 엣지 feature를 구성하는데 사용할 수 있는 제품 메타데이터가 없을 수 있다

3. GNN 선행 연구들이 low-degree 노드에서는 성능이 좋지 않다
대부분의 GNN 선행연구들이 high-degree 노드 기반 / low-degree 노드에 최적화되지 않음
하지만 이론과 현실은 다르다. 이른바 power-law
대규모 그래프에서 high-degree 노드에 비해 low-degree 노드가 훨씬 더 많다!


### 도전 과제
1. 비대칭성을 존중하면서 제품 관계 모델링하기
GCN, GraphSage, GAT 등과 같이 널리 사용되는 GNN 모델은 최적의 성능에 미치지 못함
방향성 그래프를 처리하는 NERD, APP와 같은 랜덤워크 기반 모델은 GNN에 비해 성능 떨어짐

2. 노드 / 엣지 피처를 구성하기 위한 제품 속성이 없음
초기 노드 임베딩으로 1-hot 인코딩을 사용하는 GNN 모델은 대규모 그래프에서 메모리 부족 문제를 일으킬 수 있음.
GAT, DGGAN 기반 모델은 대규모 그래프에서 매우 느리고 비효율적.
균등 [-1, 1], 정규 N(0, 1), 자비에 균등, 자비에 정규 등을 사용하여 초기화하면 최적의 성능을 얻지 못할 수 있음.

+ 확장 가능한 솔루션 필요
수십억 개의 상호 작용이 있는 수백만 개의 제품을 처리해야 함
1-hot 인코딩 벡터에 의존하는 기존 작업은 이러한 대규모 데이터셋에서 실패할 가능성

 
### BLADE(Biased Locally Adaptive Direction awarE)
1. 비대칭 처리
소스 및 타겟 임베딩을 이중으로 사용하여 각 노드를 표현
가운데는 휴대폰과 휴대폰 케이스, 전원 어댑터 등 관련 제품 간의 관계를 나타내는 그래프임
왼쪽은 기존 그래프 신경망(GNN)에서 노드 A를 임베딩
오른쪽은 BLADE에서 추천 대상(A-target)과 추천 소스(A-source)로 A를 이중 임베딩
소스 임베딩을 생성할 때는 노드의 out 이웃을 / 타겟 임베딩을 생성할 땐 in 이웃으로
이렇게 이중으로 표현하면 방향성을 구분지을 수 있음

BLADE를 이용해 모든 노드에 대해서 소스 및 타겟 임베딩 생성
쿼리 노드를 임베딩 공간에 매핑 / 잠재적 후보를 타겟 임베딩 공간에 매핑
쿼리 노드에 대한 추천 노드를 찾기 위해 최근접 이웃 탐색(Nearest Neighbor)

2. 노드 피쳐 초기화 Initial Node Embeddings
균일 분포[-1, 1], 정규 분포, Xavier 균등 및 정규 분포 등 사용할 수 있음
이 경우의 노드 피쳐 초기화는 무작위 랜덤 / 노드의 어떤 측면도 특정짓지 않음
최적의 성능을 얻지 못할 가능성이 존재함.
혹은 1-hot 인코딩을 사용할 수도 있음
하지만 이러한 GNN 모델은 대규모 그래프에서 메모리 부족 문제를 일으킬 수 있음.

전체 그래프에 대해 편향된 랜덤 워크(biased random walks)를 수행함
페이지 랭크에서 영감을 받아 RWR(Random walks with Restart) 생성(재시작 확률은 0.15로)
이렇게 생성된 초기 임베딩은 그래프의 연결 구조를 나타내기 때문에 랜덤 초기화보다 더 나음

3. 크고 작은 노드 degree에 대한 추천을 개선하기 위한 샘플링
시드 노드의 degree에 따라 이웃 샘플 크기를 locally 조정
만약 시드 노드의 degree가 낮으면 larger neighborhood로, degree가 높으면 smaller
이웃 샘플링을 수행할 때는 노드의 degree에 따라 샘플링할 엣지의 확률을 차등 처리

물론 GAT(Graph Attention)은 노드마다 다른 가중치를 암시적으로 지정할 수 있음
하지만 Attention 가중치는 노드의 이웃 feature를 기반으로 계산됨
그래프의 구조적 특성을 반영할 수 없다는 한계가 있음
attribution이 없는 그래프에는 GAT를 적용하기 어렵다.
